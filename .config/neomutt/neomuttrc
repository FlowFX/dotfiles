set mbox_type   = Maildir
set sendmail    = msmtp

set header_cache     = ~/.cache/mutt/headers # where to store headers
set message_cachedir = ~/.cache/mutt/bodies  # where to store bodies
set tmpdir           = ~/.tmp/mutt           # where to keep temp files

# MACROS and BINDINGS -------------------------
# Reload configuration file
macro index,pager ,r ":source $XDG_CONFIG_HOME/neomutt/neomuttrc<enter>"

# Sync email
macro index O "<shell-escape>offlineimap -u blinkenlights\r"      "run offlineimap to sync all mail"
macro index ,o "<shell-escape>offlineimap -u basic -q -f INBOX\r" "run offlineimap quick and quiet"


bind index D purge-message    # Don't just delete. REALLY delete!
bind pager R  group-reply

# unbind x so there will be no chance to exit mutt incidentally
bind index x noop

# don't use g
bind index g noop
bind pager g noop

# use gg and G vim-style
bind index gg first-entry
bind index G  last-entry


# View attachments properly. TODO: really?
bind attach <return> view-mailcap


bind compose p postpone-message # instead of pressing y to send I can press p to postpone the message
bind index p recall-message # edit your drafts (postponed messages) locally

# HOOKS --------------------------------------
# Sync mailbox on exit. All other mailboxes are synced whenever I change mailboxes or directories.
startup-hook 'exec sync-mailbox'
shutdown-hook 'exec sync-mailbox'

# Edit settings
set edit_headers = yes               # Put headers in editor when composing
set editor = "nvim +7 %s"            # Open Vim and move to line 7
set fast_reply = yes                 # Don't ask for Subject/recipient when replying, or Subject when forwarding
set forward_edit = yes               # Always allow to edit before forwarding
set forward_format = "Fwd: %s"       # Jesus, mutt
set include = yes                    # include body
set reflow_text = yes                # All hail format=flowed
set reflow_wrap = 78                 # If GOD would have wanted a larger number, SHE'd have given us larger screens
set wrap = 120                       # Wrap incoming text at 120 chars

# Contacts ----------------------------------------
set query_command= "khard email --parsable '%s'"      # Tab completion for address book
bind editor <Tab> complete-query
bind editor ^T    complete

macro index,pager ,a \
    "<pipe-message>khard add-email<return>" \
    "add the sender email address to khard"

# The Index
set sort =threads # Threads!

# Other configs
source $XDG_CONFIG_HOME/neomutt/mutt.d/colors
source $XDG_CONFIG_HOME/neomutt/mutt.d/sidebar

# Behavior
set delete               # don't ask, just do
set quit                 # don't ask, just do!!
set confirmappend = no   # Do not ask before deleting/moving to existing mailbox
set confirmcreate = yes  # But do ask before creating a mailbox
set auto_tag = yes          # Apply actions to all tagged mails, regardless of <tag-prefix>
set beep = no
set beep_new = no
unset mark_old           # read/new is good enough for me

source $XDG_CONFIG_HOME/neomutt/neomuttrc.local.$LOCAL_CONFIG


# PAGER VIEW OPTIONS ---------------------------------
set pager_index_lines = 10 # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs


# Deal with HTML emails
auto_view text/html text/enriched
alternative_order text/plain text/enriched text/html

# URL Views
macro pager \Cu "|urlview<enter>" "call urlview to open links"

# Deal with attachments
bind attach s noop
macro attach s "<save-entry><bol>~/Downloads/<eol>"   "Save attachment to Downloads folder
